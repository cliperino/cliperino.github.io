{"version":3,"sources":["../../src/pages/highlightclips/highlightclips.module.ts","../../src/pages/highlightclips/highlightclips.ts"],"names":[],"mappings":"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","file":"7.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { PipesModule } from '../../app/pipes/pipes.module';\r\nimport { HighlightClipsPage } from './highlightclips';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    HighlightClipsPage\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(HighlightClipsPage),\r\n    PipesModule.forRoot()\r\n  ],\r\n  providers: [\r\n  ],\r\n  entryComponents: [\r\n    HighlightClipsPage\r\n  ]\r\n})\r\nexport class HighlightClipsPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/highlightclips/highlightclips.module.ts","/* Core */\r\nimport { Component, NgZone, OnInit } from '@angular/core';\r\nimport { IonicPage, NavController, ModalController, NavParams } from 'ionic-angular';\r\n\r\n/* Models */\r\n\r\n/* Services */\r\nimport { LoaderService } from '../../app/services/loader.service';\r\nimport { ToastService } from '../../app/services/toast.service';\r\nimport { HighlightsService } from '../../app/services/highlights.service';\r\nimport { HighlightModel } from '../../app/models/highlight.model';\r\nimport { ClipsService } from '../../app/services/clips.service';\r\nimport { HighlightClipModel } from '../../app/models/highlightclip.model';\r\n\r\n@IonicPage({\r\n  defaultHistory: ['highlights'],\r\n  name: 'highlightclips',\r\n  segment: 'highlightclips/:highlight'\r\n})\r\n@Component({\r\n  selector: 'page-highlightclips',\r\n  templateUrl: 'highlightclips.html'\r\n})\r\nexport class HighlightClipsPage implements OnInit {\r\n  public highlightUuid: string;\r\n  public highlight: HighlightModel;\r\n  public isEditing = false;\r\n\r\n  public clipsReady: Promise<any>;\r\n\r\n  public removeList: any[] = [];\r\n\r\n  constructor(\r\n    public navCtrl: NavController,\r\n    private ngZone: NgZone,\r\n    private navParams: NavParams,\r\n    public modalCtrl: ModalController,\r\n\r\n    /* Services */\r\n    private highlightsService: HighlightsService,\r\n    private clipsService: ClipsService,\r\n    private loaderService: LoaderService,\r\n    private toastService: ToastService) {\r\n      this.highlightUuid = this.navParams.get('highlight');\r\n    }\r\n\r\n  async ngOnInit(): Promise<any> {\r\n    await this.getHighlight();\r\n    await this.getClips();\r\n\r\n    this.highlight.clips.sort(this.sort);\r\n  }\r\n\r\n  edit() {\r\n    this.isEditing = true;\r\n  }\r\n\r\n  async save() {\r\n    let allPromise: Promise<any> = null;\r\n    let deletePromise: Promise<any> = null;\r\n    let updatePromise: Promise<any> = null;\r\n\r\n    this.isEditing = false;\r\n\r\n    deletePromise = this.deleteClips();\r\n    updatePromise = this.updateClipOrders();\r\n\r\n    allPromise = Promise.all([deletePromise, updatePromise]);\r\n\r\n    this.loaderService.show(allPromise);\r\n    this.toastService.onFailure(allPromise);\r\n  }\r\n\r\n  async getClips(): Promise<any> {\r\n    const promiseList = [];\r\n    this.highlight.clips.forEach(async (clip: any, index: number) => {\r\n      const promise = this.clipsService.getBySlug(clip.slug);\r\n      const c = await promise;\r\n      clip.clipOrder = index;\r\n      clip.description = c.description;\r\n      clip.thumbnail = c.thumbnails.medium;\r\n      clip.broadcaster = c.broadcaster;\r\n      clip.title = c.title;\r\n      clip.originalDuration = c.duration;\r\n    });\r\n\r\n    this.clipsReady = Promise.all(promiseList);\r\n\r\n    return await this.clipsReady;\r\n  }\r\n\r\n  async getHighlight(): Promise<any> {\r\n    let that = this;\r\n    let promise;\r\n\r\n    promise = this.highlightsService.getByUuid(this.highlightUuid).then(function(highlight: HighlightModel) {\r\n      that.ngZone.run(() => {\r\n        that.highlight = highlight;\r\n      });\r\n    });\r\n\r\n    that.loaderService.show(promise);\r\n    that.toastService.onFailure(promise);\r\n\r\n    return await promise;\r\n  }\r\n\r\n  /**\r\n   * Moves up locally until the user saves the modifications\r\n   * \r\n   * @param clip \r\n   */\r\n  async moveUp(clip: any) {\r\n    const currentIndex = clip.clipOrder;\r\n    const lastIndex = currentIndex - 1;\r\n    const lastClip = this.findClipWithIndex(lastIndex);\r\n\r\n    clip.clipOrder -= 1;\r\n    lastClip.clipOrder += 1;\r\n  }\r\n\r\n  /**\r\n   * Moves down locally until the user saves the modifications\r\n   * \r\n   * @param clip \r\n   */\r\n  moveDown(clip: any) {\r\n    const currentIndex = clip.clipOrder;\r\n    const nextIndex = currentIndex + 1;\r\n    const nextClip = this.findClipWithIndex(nextIndex);\r\n\r\n    clip.clipOrder += 1;\r\n    nextClip.clipOrder -= 1;\r\n\r\n    this.highlight.clips.sort(this.sort);\r\n  }\r\n\r\n  /**\r\n   * Removes locally until the user saves the modifications \r\n   * \r\n   * @param clip \r\n   */\r\n  async remove(clip: any) {\r\n    this.removeList.push(clip);\r\n\r\n    const index = this.findClipIndex(clip);\r\n\r\n    this.highlight.clips.forEach((c: any, i: number) => {\r\n      if (index === i) {\r\n        this.highlight.clips.splice(index, 1);\r\n      } else if (i > index) {\r\n        c.clipOrder -=1 ;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private async deleteClips(): Promise<any> {\r\n    const promiseList = [];\r\n    this.removeList.forEach(clip => {\r\n      promiseList.push(this.highlightsService.removeClipHighlight(this.highlightUuid, clip.uuid));\r\n    });\r\n\r\n    await Promise.all(promiseList);\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private async updateClipOrders(): Promise<any> {\r\n    const promiseList = [];\r\n\r\n    this.highlight.clips.forEach((clip: any) => {\r\n      const highlightClip = new HighlightClipModel();\r\n\r\n      highlightClip.clipOrder = clip.clipOrder;\r\n      highlightClip.duration = clip.duration;\r\n      highlightClip.slug = clip.slug;\r\n      highlightClip.startTime = clip.startTime;\r\n      highlightClip.uuid = clip.uuid;\r\n\r\n      const promise = this.highlightsService.updateHighlightClip(this.highlightUuid, highlightClip);\r\n      promiseList.push(promise);\r\n    });\r\n\r\n    await Promise.all(promiseList);\r\n  }\r\n\r\n  private findClipIndex(clip: any): number {\r\n    let index = null;\r\n    this.highlight.clips.forEach((c: any, i: number) => {\r\n      if (c.uuid === clip.uuid) {\r\n        index = i;\r\n      }\r\n    });\r\n\r\n    return index;\r\n  }\r\n\r\n  private findClipWithIndex(index: number): any {\r\n    let clip: any = null;\r\n    this.highlight.clips.forEach((c: any) => {\r\n      if (c.clipOrder === index) {\r\n        clip = c;\r\n      }\r\n    });\r\n\r\n    return clip;\r\n  }\r\n\r\n  private sort(a: any, b: any) {\r\n    return a.clipOrder - b.clipOrder;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/highlightclips/highlightclips.ts"],"sourceRoot":""}